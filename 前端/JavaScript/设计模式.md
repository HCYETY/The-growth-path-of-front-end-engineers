## 设计模式
### 发布订阅模式
1. 定义  
发布-订阅模式其实是一种对象间一对多的依赖关系，当一个对象的状态发送改变时，所有依赖于它的对象都将得到状态改变的通知。
> 订阅者（Subscriber）把自己想订阅的事件注册（Subscribe）到调度中心（Event Channel），当发布者（Publisher）发布该事件（Publish Event）到调度中心，也就是该事件触发时，由调度中心统一调度（Fire Event）订阅者注册到调度中心的处理代码。

举个栗子：
> 比如我们很喜欢看某个公众号号的文章，但是我们不知道什么时候发布新文章，要不定时的去翻阅。这时候，我们可以关注该公众号，当有文章推送时，会有消息及时通知我们文章更新了。

在上面的栗子中，公众号属于发布者，用户属于订阅者。用户将订阅公众号的事件注册到调度中心，公众号作为发布者，当有新文章发布时，公众号发布该事件到调度中心，调度中心会及时发消息告知用户。

2. 实现发布-订阅模式
- 实现思路
    - 创建一个对象
    - 在该对象上创建一个缓存列表（调度中心）
    - on 方法用来把函数 fn 都加到缓存列表中（订阅者注册事件到调度中心）
    - emit 方法取到 arguments 里第一个当做 event，根据 event 值去执行对应缓存列表中的函数（发布者发布事件到调度中心，调度中心处理代码）
    - off 方法可以根据 event 值取消订阅（取消订阅）
    - once 方法只监听一次，调用完毕后删除缓存函数（订阅一次）
3. 应用
    - 应用程序需要向大量消费者广播信息。例如微信订阅号就是一个消费者量庞大的广播平台。
    - 应用程序需要与一个或多个独立开发的应用程序或服务通信，这些应用程序或服务可能使用不同的平台、编程语言和通信协议。
    - 应用程序可以向消费者发送信息，而不需要消费者的实时响应。
    - 被集成的系统被设计为支持其数据的最终一致性模型。
    - 应用程序需要将信息传递给多个消费者，这些消费者可能具有与发送者不同的可用性要求或正常运行时间计划。例如你消息在上午发布了出去，消费者计划在下午才去处理这些消息。
4. 总结：
- 优点
    - 对象之间解耦
    - 异步编程中，可以更松耦合的代码编写
- 缺点
    - 创建订阅者本身要消耗一定的时间和内存
    - 虽然可以弱化对象之间的联系，多个发布者和订阅者嵌套一起的时候，程序难以跟踪维护
5. 扩展（发布-订阅模式与观察者模式的区别）  
很多地方都说发布-订阅模式是观察者模式的别名，但他们其实并不一样![](img/28.png)
- 观察者模式：观察者（Observer）直接订阅（Subscribe）主题（Subject），而当主题被激活的时候，会触发（Fire Event）观察者里的事件。
- 发布订阅模式：订阅者（Subscriber）把自己想订阅的事件注册（Subscribe）到调度中心（Event Channel），当发布者（Publisher）发布该事件（Publish Event）到调度中心，也就是该事件触发时，由调度中心统一调度（Fire Event）订阅者注册到调度中心的处理代码。
- 差异：
  - 1.1、在观察者模式中，观察者是知道 Subject 的，Subject 一直保持对观察者进行记录。然而，在发布订阅模式中，发布者和订阅者不知道对方的存在。它们只有通过消息代理进行通信。
  - 1.2、在发布订阅模式中，组件是松散耦合的，正好和观察者模式相反。
  - 2.1、观察者模式大多数时候是同步的，比如当事件触发，Subject 就会去调用观察者的方法。而发布-订阅模式大多数时候是异步的（使用消息队列）。
  - 2.2、观察者模式需要在单个应用程序地址空间中实现，而发布-订阅更像交叉应用模式。